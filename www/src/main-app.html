<link rel='import' href='../bower_components/polymer/polymer.html'>
<link rel='import' href='./layouts/login-form.html'>


<dom-module id='main-app'>
    <template>
        <template is='dom-if' if='[[goLocal]]'>
            <iframe src="http://192.168.1.104:8123" frameborder="0" style="overflow:hidden;overflow-x:hidden;overflow-y:hidden;height:100%;width:100%;position:absolute;top:0px;left:0px;right:0px;bottom:0px" height="100%" width="100%"></iframe>
        </template>
        <template is='dom-if' if='[[goRemote]]'>
            <iframe src="[[remoteAddress]]" frameborder="0" style="overflow:hidden;overflow-x:hidden;overflow-y:hidden;height:100%;width:100%;position:absolute;top:0px;left:0px;right:0px;bottom:0px" height="100%" width="100%"></iframe>
        </template>
        <template is='dom-if' if="{{goLogin}}">
            <login-form signed-inn="{{signedIn}}" domo-present="[[localDomoInstance]]" spinnerinfo="{{loadingFormInfo}}" go-local="{{forceLocal}}" link-string="{{remoteLinkAvailable}}">
            </login-form>
        </template>
    </template>
</dom-module>

<script>
function fixiFrame () {
   if (true) {
      iFrameContentHeight = document.getElementById('theiFrame').contentDocument.body.offsetHeight;
      document.getElementById('theiFrame').style.height = iFrameContentHeight + 'px';
   }
};

Polymer({
  is: 'main-app',

  properties: {
    localDomoInstance: {
      type: Boolean,
      value: false,
      notify: true,
    },

    loadingFormInfo: {
      type: String,
      value: "Loading App...",
      notify: true,
      reflectToAttribute: true,
    },

    domoInfo: {
      type: Object,
      notify: true,
    },

    localIpAddress: {
      type: String,
      notify: true,
    },

    signedIn: {
        type: Boolean,
        notify: true,
        value: false,
        observer: '_signInChanged'
    },

    forceLocal: {
        type: Boolean,
        notify: true,
        value: false,
    },

    remoteAddress: {
        type: String,
        computed: '_computeAdress(remoteLinkAvailable)'
    },

    goRemote: {
        type: Boolean,
        computed: '_computeGoRemote(signedIn, remoteAddress)'
    },

    goLogin: {
        type: Boolean,
        value: true,
        computed: '_computeGoLogin(forceLocal, remoteAddress)'
    },

    goLocal: {
    type: Boolean,
    computed: '_computeGoLocal(forceLocal, localDomoInstance)'
    }


  },

  _signInChanged: function (){
      console.log("signed in changed to: " + this.signedIn);
  },

  _computeAdress: function (remoteLinkAvailable) {
      console.log("update remoteLinkAvailable to: " + remoteLinkAvailable);
      if (remoteLinkAvailable != null) {
          //return "http://asdasdas" + remoteLinkAvailable;
          return "https://tbhazpcx.p50.weaved.com/";
      }
      else {
          return null;
      }
  },

  _computeGoRemote: function (signedIn, remoteAddress) {
      console.log("setting remote to: " + (/*signedIn && */!!remoteAddress));
      return /*signedIn &&*/ !!remoteAddress;
  },

  _computeGoLogin: function (forceLocal, remoteAddress) {
      console.log("setting login to: " + (forceLocal && remoteAddress));
      return !forceLocal && !remoteAddress;
  },

  _computeGoLocal: function (forceLocal, localDomoInstance) {
      console.log("setting local to: " + (forceLocal && localDomoInstance));
      return forceLocal && localDomoInstance;
  },

  ready: function(){
        this.loadingFormInfo = "Looking for Domo Device...";
        /*var ZeroConf = cordova.plugins.zeroconf;
        console.log(ZeroConf);
        ZeroConf.watch('_domo._tcp.local.', 
                       function(resp){            
                          console.log("Found Domo Device");
                          console.log(JSON.stringify(resp.service));
                          this.localDomoInstance = true;
                          this.localIpAddress = resp.service;
                        }.bind(this)
        );*/

        console.log("Main-app ready");
      },
});

</script>
